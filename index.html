<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>„É¥„Ç°„É≥„Éë„Ç§„Ç¢ÂÖ®Áü•ÂÖ®ËÉΩ ËæûÂÖ∏</title>

<style>
:root{
  --bg:#0b0f14;
  --panel:#151822;
  --panel2:#0f1320;
  --border:#252a36;
  --text:#e6e8ee;
  --muted:#9aa0aa;
  --muted2:#7b8192;

  --accent:#7b5cff;
  --accent2:#36d1dc;
  --accent3:#fb7185;

  --radius:16px;
  --shadow: 0 18px 65px rgba(0,0,0,.45);
}

*{box-sizing:border-box}

body{
  background:
    radial-gradient(1200px 700px at 10% 10%, rgba(123,92,255,.22), transparent 55%),
    radial-gradient(900px 600px at 90% 15%, rgba(54,209,220,.16), transparent 55%),
    radial-gradient(900px 650px at 20% 90%, rgba(251,113,133,.12), transparent 55%),
    var(--bg);
  color:var(--text);
  font-family:"Yu Gothic","Hiragino Kaku Gothic ProN",system-ui,sans-serif;
  margin:0;
  line-height:1.95;
}

header{
  position:sticky;
  top:0;
  z-index:10;
  background: rgba(11,15,20,.72);
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
  border-bottom:1px solid var(--border);
}

.topbar{
  max-width:1150px;
  margin:auto;
  padding:18px 18px 12px;
  display:flex;
  gap:18px;
  align-items:flex-start;
  justify-content:space-between;
  flex-wrap:wrap;
}

.brand{
  min-width:280px;
}
.brand .t{
  font-size:20px;
  font-weight:800;
  letter-spacing:1.4px;
}
.brand .s{
  margin-top:6px;
  color:var(--muted);
  font-size:13px;
}
.brand .s span{
  color:var(--muted2);
}

nav{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
  justify-content:flex-end;
}

.tabbtn{
  cursor:pointer;
  border:1px solid var(--border);
  background: rgba(255,255,255,.05);
  color:var(--muted);
  padding:9px 12px;
  border-radius:999px;
  font-size:13px;
  user-select:none;
  transition: transform .08s ease, background .2s ease, color .2s ease, border-color .2s ease;
  box-shadow: var(--shadow);
}
.tabbtn:active{ transform: translateY(1px); }

.tabbtn.active{
  color:var(--text);
  border-color: rgba(54,209,220,.35);
  background:
    linear-gradient(90deg,
      rgba(123,92,255,.18),
      rgba(54,209,220,.15),
      rgba(251,113,133,.12)
    );
}

.container{
  max-width:1150px;
  margin:auto;
  padding:34px 18px 90px;
}

.section{ display:none; }
.section.active{ display:block; }

.grid{
  display:grid;
  grid-template-columns: 1.15fr .85fr;
  gap:16px;
}
@media (max-width: 980px){
  .grid{ grid-template-columns: 1fr; }
}

.panel{
  background: rgba(255,255,255,.06);
  border:1px solid var(--border);
  border-radius:22px;
  padding:16px;
  box-shadow: var(--shadow);
}

.panel h2{
  margin: 0 0 8px;
  font-size: 15px;
  letter-spacing:.6px;
}
.hint{
  color:var(--muted);
  font-size:13px;
  margin-top:0;
}

.searchbox{
  margin-top:12px;
  display:flex;
  gap:10px;
}
.searchbox input{
  width:100%;
  padding:12px 14px;
  border-radius:14px;
  border:1px solid var(--border);
  background: rgba(255,255,255,.06);
  color:var(--text);
  outline:none;
}
.searchbox input::placeholder{ color:var(--muted2); }

.card{
  background: rgba(255,255,255,.07);
  border:1px solid var(--border);
  border-radius: var(--radius);
  padding:16px;
  margin-top:12px;
}

.jp{
  font-size:22px;
  font-weight:900;
  letter-spacing:.5px;
  color:var(--accent2);
}
.hira{
  margin-top:6px;
  color:var(--muted);
  font-size:13px;
}
.mean{
  margin-top:8px;
  font-size:14px;
  color:var(--text);
  font-weight:600;
}

.badges{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-top:10px;
}
.badge{
  font-size:11px;
  border:1px solid var(--border);
  padding:3px 8px;
  border-radius:999px;
  color:var(--muted);
}
.badge.n5{ border-color: rgba(52,211,153,.35); color: rgba(52,211,153,.95); }
.badge.n4{ border-color: rgba(123,92,255,.45); color: rgba(123,92,255,.95); }
.badge.tag{ border-color: rgba(54,209,220,.35); color: rgba(54,209,220,.95); }

.ex{
  margin-top:14px;
  padding-top:12px;
  border-top:1px solid rgba(255,255,255,.08);
}
.ex h4{
  margin:0 0 6px;
  font-size:13px;
  color:var(--accent2);
}
.exline{
  margin:10px 0 10px;
}
.exline b{ color:var(--text); }
.exline .k{ color:var(--accent2); }
.exp{
  color:var(--muted);
  font-size:13px;
  margin-top:6px;
}

.mini{
  display:inline-flex;
  align-items:center;
  gap:8px;
  margin-top:10px;
}
.btn{
  cursor:pointer;
  border:1px solid var(--border);
  background: rgba(255,255,255,.05);
  color:var(--text);
  padding:8px 10px;
  border-radius:12px;
  font-size:12px;
  user-select:none;
}
.btn.primary{
  border-color: rgba(54,209,220,.35);
  background: rgba(54,209,220,.12);
}
.btn.danger{
  border-color: rgba(251,113,133,.35);
  background: rgba(251,113,133,.10);
}

.kanjigrid{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(92px, 1fr));
  gap:12px;
  margin-top:12px;
}
.kanjiitem{
  background: rgba(255,255,255,.06);
  border:1px solid var(--border);
  border-radius: 16px;
  padding:12px 10px;
  text-align:center;
  cursor:pointer;
  transition: transform .12s ease, border-color .2s ease;
}
.kanjiitem:hover{
  transform: translateY(-1px);
  border-color: rgba(54,209,220,.28);
}
.kanjiitem .k{
  font-size:28px;
  font-weight:900;
  color:var(--accent2);
}
.kanjiitem .lvl{
  margin-top:6px;
  font-size:11px;
  color:var(--muted);
}
.kanjiitem .lvl b{
  color:var(--text);
}
.footer{
  text-align:center;
  padding:40px 0 0;
  color:var(--muted);
  font-size:12px;
}
hr.sep{
  border:none;
  border-top:1px solid rgba(255,255,255,.08);
  margin:14px 0;
}
.small{
  color:var(--muted);
  font-size:13px;
}
</style>
</head>

<body>

<header>
  <div class="topbar">
    <div class="brand">
      <div class="t">„É¥„Ç°„É≥„Éë„Ç§„Ç¢ÂÖ®Áü•ÂÖ®ËÉΩ ËæûÂÖ∏</div>
      <div class="s">
        „É¥„Ç°„É≥„Éë„Ç§„Ç¢ = vampiro <span>Ôºàobservador eternoÔºâ</span> / ÂÖ®Áü• = onisciente / ÂÖ®ËÉΩ = onipotente
      </div>
    </div>

    <nav>
      <div class="tabbtn active" id="tab-dic" onclick="openTab('dic')">üìñ Dicion√°rio</div>
      <div class="tabbtn" id="tab-kanji" onclick="openTab('kanji')">üà∂ Kanji (N5‚ÜíN4)</div>
      <div class="tabbtn" id="tab-about" onclick="openTab('about')">‚ÑπÔ∏è Sobre</div>
    </nav>
  </div>
</header>

<div class="container">

  <!-- ====================== DICION√ÅRIO ====================== -->
  <section id="dic" class="section active">
    <div class="grid">
      <div class="panel">
        <h2>Dicion√°rio (JP ‚Üí PT-BR)</h2>
        <p class="hint">Digite uma palavra em japon√™s (kanji/kana) ou portugu√™s. Ex.: È£ü„Åπ„Çã / „Åí„Çì„Åç / ‚Äútranquilo‚Äù.</p>

        <div class="searchbox">
          <input id="q" type="text" placeholder="Buscar palavra..." autocomplete="off" />
          <div class="btn danger" onclick="clearSearch()">Limpar</div>
        </div>

        <div id="results"></div>
      </div>

      <div class="panel">
        <h2>Como estudar (m√©todo simples)</h2>
        <p class="small">
          1) Busque uma palavra ‚Üí leia o significado.<br>
          2) Leia as 3 frases em japon√™s (sem PT).<br>
          3) Revele hiragana, depois a tradu√ß√£o.<br>
          4) Compare as estruturas (part√≠culas, tempos, padr√£o).<br>
        </p>
        <hr class="sep">
        <div class="mini">
          <div class="btn primary" onclick="randomWord()">Palavra aleat√≥ria</div>
          <div class="btn" onclick="openTab('kanji')">Ver kanji (N5‚ÜíN4)</div>
        </div>
      </div>
    </div>
  </section>

  <!-- ====================== KANJI LISTA ====================== -->
  <section id="kanji" class="section">
    <div class="panel">
      <h2>Kanji ‚Äî ordem N5 ‚Üí N4</h2>
      <p class="hint">Clique em um kanji para abrir o Dicion√°rio e ver significado + exemplos. (N5 aparece primeiro, depois N4)</p>
      <div class="kanjigrid" id="kanjigrid"></div>
    </div>
  </section>

  <!-- ====================== SOBRE ====================== -->
  <section id="about" class="section">
    <div class="panel">
      <h2>Sobre ‚Äî „É¥„Ç°„É≥„Éë„Ç§„Ç¢ÂÖ®Áü•ÂÖ®ËÉΩ</h2>
      <p class="small">
        Este site √© o <b>ËæûÂÖ∏ (dicion√°rio)</b> do projeto <b>„É¥„Ç°„É≥„Éë„Ç§„Ç¢ÂÖ®Áü•ÂÖ®ËÉΩ</b>.<br>
        A proposta √© estudo pr√°tico (N5‚ÜíN4): palavra ‚Üí frases reais ‚Üí explica√ß√£o detalhada em PT-BR.<br><br>

        <b>Por que ‚Äú„É¥„Ç°„É≥„Éë„Ç§„Ç¢ÂÖ®Áü•ÂÖ®ËÉΩ‚Äù?</b><br>
        ‚ÄúVampiro‚Äù como met√°fora do observador eterno: coleta, registra, compara e entende padr√µes na linguagem.<br>
        ‚ÄúÂÖ®Áü•ÂÖ®ËÉΩ‚Äù como disciplina: aprender sistematicamente, sem pular fundamentos.
      </p>
      <hr class="sep">
      <p class="small">
        Conte√∫do e estrutura: <b>„É¥„Ç°„É≥„Éë„Ç§„Ç¢ÂÖ®Áü•ÂÖ®ËÉΩ</b><br>
        Objetivo: tornar o japon√™s do cotidiano estud√°vel com precis√£o.
      </p>
    </div>
  </section>

  <div class="footer">„É¥„Ç°„É≥„Éë„Ç§„Ç¢ÂÖ®Áü•ÂÖ®ËÉΩ ¬© 2025 ‚Äî ËæûÂÖ∏ / Kanji / Estudo do cotidiano</div>
</div>

<script>
/* =========================
   DADOS: PALAVRAS (DICION√ÅRIO)
   Adicione aqui para expandir.
   ========================= */
const WORDS = [
  {
    jp:"È£ü„Åπ„Çã",
    hira:"„Åü„Åπ„Çã",
    tipo:"verbo (ichidan)",
    mean:"comer",
    tags:["N5","cotidiano"],
    examples:[
      {
        jp:"Êúù„Åî„ÅØ„Çì„ÇíÈ£ü„Åπ„Åæ„Åó„Åü„ÄÇ",
        hira:"„ÅÇ„Åï„Åî„ÅØ„Çì „Çí „Åü„Åπ„Åæ„Åó„Åü„ÄÇ",
        pt:"Comi caf√© da manh√£.",
        exp:"Êúù„Åî„ÅØ„Çì = caf√© da manh√£; „Çí marca objeto; „Äú„Åæ„Åó„Åü = passado polido."
      },
      {
        jp:"‰Ωï„ÇíÈ£ü„Åπ„Åü„ÅÑ„Åß„Åô„ÅãÔºü",
        hira:"„Å™„Å´ „Çí „Åü„Åπ„Åü„ÅÑ „Åß„Åô „ÅãÔºü",
        pt:"O que voc√™ quer comer?",
        exp:"„Äú„Åü„ÅÑ = querer; „Åß„Åô„Åã = pergunta educada; padr√£o de restaurante/conversa."
      },
      {
        jp:"Âèã„Å†„Å°„Å®Êòº„Åî„ÅØ„Çì„ÇíÈ£ü„Åπ„Å´Ë°å„Åç„Åæ„Åô„ÄÇ",
        hira:"„Å®„ÇÇ„Å†„Å° „Å® „Å≤„Çã„Åî„ÅØ„Çì „Çí „Åü„Åπ „Å´ „ÅÑ„Åç„Åæ„Åô„ÄÇ",
        pt:"Vou almo√ßar com um amigo.",
        exp:"„Äú„Å´Ë°å„Åè = ir para fazer algo; estrutura fixa: VËæûÊõ∏+„Å´Ë°å„Åè / V„Åæ„Åô-stem+„Å´Ë°å„Åè."
      }
    ]
  },
  {
    jp:"ÂÖÉÊ∞ó",
    hira:"„Åí„Çì„Åç",
    tipo:"„Å™-adjetivo / substantivo",
    mean:"bem, saud√°vel, animado",
    tags:["N5","cotidiano"],
    examples:[
      {
        jp:"ÂÖÉÊ∞ó„Åß„Åô„ÅãÔºü",
        hira:"„Åí„Çì„Åç „Åß„Åô „ÅãÔºü",
        pt:"Tudo bem?",
        exp:"Pergunta padr√£o. „Åß„Åô = polido; „Åã = interrogativa."
      },
      {
        jp:"‰ªäÊó•„ÅØÂÖÉÊ∞ó„Åå„Å™„ÅÑ„Å≠„ÄÇ",
        hira:"„Åç„Çá„ÅÜ „ÅØ „Åí„Çì„Åç „Åå „Å™„ÅÑ „Å≠„ÄÇ",
        pt:"Hoje voc√™ n√£o parece bem.",
        exp:"„Äú„Åå„Å™„ÅÑ = n√£o ter; „Å≠ suaviza e pede concord√¢ncia (tom de conversa)."
      },
      {
        jp:"Â≠ê„Å©„ÇÇ„Åü„Å°„ÅØÂÖÉÊ∞ó„Å´Ëµ∞„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
        hira:"„Åì„Å©„ÇÇ„Åü„Å° „ÅØ „Åí„Çì„Åç „Å´ „ÅØ„Åó„Å£„Å¶ „ÅÑ„Åæ„Åô„ÄÇ",
        pt:"As crian√ßas est√£o correndo cheias de energia.",
        exp:"ÂÖÉÊ∞ó„Å´ = 'com energia' (adv√©rbio); „Äú„Å¶„ÅÑ„Çã = a√ß√£o em andamento."
      }
    ]
  },
  {
    jp:"Â§ß‰∏àÂ§´",
    hira:"„Å†„ÅÑ„Åò„Çá„ÅÜ„Å∂",
    tipo:"„Å™-adjetivo / express√£o",
    mean:"tudo bem; tranquilo; sem problemas",
    tags:["N5","cotidiano"],
    examples:[
      {
        jp:"Â§ß‰∏àÂ§´„Åß„Åô„ÅãÔºü",
        hira:"„Å†„ÅÑ„Åò„Çá„ÅÜ„Å∂ „Åß„Åô „ÅãÔºü",
        pt:"Voc√™ est√° bem?",
        exp:"Padr√£o de checagem/aten√ß√£o. Pode ser sa√∫de, situa√ß√£o, entendimento."
      },
      {
        jp:"Â§ß‰∏àÂ§´„ÄÅÈñì„Å´Âêà„ÅÜ„Çà„ÄÇ",
        hira:"„Å†„ÅÑ„Åò„Çá„ÅÜ„Å∂„ÄÅ„Åæ„Å´„ÅÇ„ÅÜ „Çà„ÄÇ",
        pt:"Tranquilo, vai dar tempo.",
        exp:"Èñì„Å´Âêà„ÅÜ = dar tempo/chegar a tempo; „Çà = afirma√ß√£o confiante."
      },
      {
        jp:"„Åì„ÅÆÊúç„ÅßÂ§ß‰∏àÂ§´Ôºü",
        hira:"„Åì„ÅÆ „Åµ„Åè „Åß „Å†„ÅÑ„Åò„Çá„ÅÜ„Å∂Ôºü",
        pt:"Essa roupa t√° ok assim?",
        exp:"„Åß = condi√ß√£o/estado ('com isso'); pergunta casual."
      }
    ]
  },
  {
    jp:"Ë¶ã„Çã",
    hira:"„Åø„Çã",
    tipo:"verbo (ichidan)",
    mean:"ver; assistir; olhar",
    tags:["N5","cotidiano"],
    examples:[
      {
        jp:"„ÉÜ„É¨„Éì„ÇíË¶ã„Åæ„Åô„ÄÇ",
        hira:"„Å¶„Çå„Å≥ „Çí „Åø„Åæ„Åô„ÄÇ",
        pt:"Assisto TV.",
        exp:"„Çí marca o objeto; „Åæ„Åô = polidez."
      },
      {
        jp:"Êò†Áîª„ÇíË¶ã„Å´Ë°å„Åç„Åæ„Åô„ÄÇ",
        hira:"„Åà„ÅÑ„Åå „Çí „Åø „Å´ „ÅÑ„Åç„Åæ„Åô„ÄÇ",
        pt:"Vou assistir um filme (vou ao cinema).",
        exp:"V„Åæ„Åô-stem + „Å´Ë°å„Åè = ir para fazer algo. (Ë¶ã„Åæ„Åô‚ÜíË¶ã)."
      },
      {
        jp:"„Å°„Çá„Å£„Å®Ë¶ã„Å¶„ÇÇ„ÅÑ„ÅÑ„Åß„Åô„ÅãÔºü",
        hira:"„Å°„Çá„Å£„Å® „Åø„Å¶„ÇÇ „ÅÑ„ÅÑ „Åß„Åô „ÅãÔºü",
        pt:"Posso dar uma olhada?",
        exp:"„Äú„Å¶„ÇÇ„ÅÑ„ÅÑ„Åß„Åô„Åã = pedir permiss√£o; „Å°„Çá„Å£„Å® suaviza o pedido."
      }
    ]
  },

  /* Kanji como entradas tamb√©m ajuda na busca por 1 caractere */
  {
    jp:"Ë°å",
    hira:"„ÅÑ„Åè / „Åä„Åì„Å™„ÅÜ",
    tipo:"kanji (base)",
    mean:"ir; realizar",
    tags:["N5","kanji"],
    examples:[
      {
        jp:"ÈßÖ„Åæ„ÅßÊ≠©„ÅÑ„Å¶Ë°å„Åç„Åæ„Åô„ÄÇ",
        hira:"„Åà„Åç „Åæ„Åß „ÅÇ„Çã„ÅÑ„Å¶ „ÅÑ„Åç„Åæ„Åô„ÄÇ",
        pt:"Vou at√© a esta√ß√£o caminhando.",
        exp:"„Åæ„Åß = at√©; „Äú„Å¶Ë°å„Åè = ir fazendo (aqui literal: ir)."
      },
      {
        jp:"Êù•ÈÄ±„ÄÅÁóÖÈô¢„Å´Ë°å„Åè‰∫àÂÆö„Åß„Åô„ÄÇ",
        hira:"„Çâ„ÅÑ„Åó„ÇÖ„ÅÜ„ÄÅ„Å≥„Çá„ÅÜ„ÅÑ„Çì „Å´ „ÅÑ„Åè „Çà„Å¶„ÅÑ „Åß„Åô„ÄÇ",
        pt:"Semana que vem, planejo ir ao hospital.",
        exp:"‰∫àÂÆö„Åß„Åô = plano (N4); estrutura: VËæûÊõ∏ + ‰∫àÂÆö„Åß„Åô."
      },
      {
        jp:"‰ºöË≠∞„ÇíË°å„ÅÑ„Åæ„Åô„ÄÇ",
        hira:"„Åã„ÅÑ„Åé „Çí „Åä„Åì„Å™„ÅÑ„Åæ„Åô„ÄÇ",
        pt:"Vamos realizar a reuni√£o.",
        exp:"Ë°å„ÅÜ („Åä„Åì„Å™„ÅÜ) √© leitura/uso mais formal: realizar, executar."
      }
    ]
  }
];

/* =========================
   DADOS: KANJI (ORDEM N5‚ÜíN4)
   Clique no kanji = abre o dicion√°rio e busca.
   ========================= */
const KANJI_ORDER = [
  // N5 (primeiro)
  {k:"Êó•", lvl:"N5"}, {k:"‰∏Ä", lvl:"N5"}, {k:"‰∫∫", lvl:"N5"}, {k:"Â§ß", lvl:"N5"}, {k:"Êú¨", lvl:"N5"},
  {k:"‰∏≠", lvl:"N5"}, {k:"Â≠¶", lvl:"N5"}, {k:"Ë°å", lvl:"N5"}, {k:"Ë¶ã", lvl:"N5"}, {k:"È£ü", lvl:"N5"},
  {k:"È£≤", lvl:"N5"}, {k:"Êù•", lvl:"N5"}, {k:"Ë®Ä", lvl:"N5"}, {k:"ÊÄù", lvl:"N5"}, {k:"‰ºö", lvl:"N5"},
  {k:"‰ªä", lvl:"N5"}, {k:"Âêç", lvl:"N5"}, {k:"Ë©±", lvl:"N5"}, {k:"‰Ωï", lvl:"N5"}, {k:"Ëªä", lvl:"N5"},
  {k:"ÂÖà", lvl:"N5"}, {k:"Âèã", lvl:"N5"}, {k:"Êõ∏", lvl:"N5"}, {k:"Ë™≠", lvl:"N5"}, {k:"ËÅû", lvl:"N5"},
  {k:"Ë≤∑", lvl:"N5"}, {k:"Êñ∞", lvl:"N5"}, {k:"ÊôÇ", lvl:"N5"}, {k:"‰Ωè", lvl:"N5"},

  // N4 (depois)
  {k:"ËÄÉ", lvl:"N4"}, {k:"Á∂ö", lvl:"N4"}, {k:"Âõ∞", lvl:"N4"}, {k:"Ê±∫", lvl:"N4"}, {k:"‰∫à", lvl:"N4"},
  {k:"Â§â", lvl:"N4"}, {k:"ÈÅÖ", lvl:"N4"}, {k:"Âøò", lvl:"N4"}, {k:"Ëøî", lvl:"N4"}, {k:"Áõ¥", lvl:"N4"},
  {k:"ÁΩÆ", lvl:"N4"}, {k:"Ëµ∑", lvl:"N4"}, {k:"Áú†", lvl:"N4"}, {k:"‰πó", lvl:"N4"}, {k:"Èôç", lvl:"N4"},
  {k:"ÊóÖ", lvl:"N4"}, {k:"Ë™¨", lvl:"N4"}, {k:"ÁêÜ", lvl:"N4"}, {k:"Áî±", lvl:"N4"}, {k:"Áµå", lvl:"N4"},
  {k:"È®ì", lvl:"N4"}, {k:"ÈÅã", lvl:"N4"}, {k:"Âêà", lvl:"N4"}, {k:"Áî≥", lvl:"N4"}, {k:"‰ªò", lvl:"N4"}
];

/* =========================
   L√ìGICA DO SITE
   ========================= */
const sections = {
  dic: document.getElementById("dic"),
  kanji: document.getElementById("kanji"),
  about: document.getElementById("about")
};

const tabs = {
  dic: document.getElementById("tab-dic"),
  kanji: document.getElementById("tab-kanji"),
  about: document.getElementById("tab-about")
};

const q = document.getElementById("q");
const results = document.getElementById("results");
const kanjigrid = document.getElementById("kanjigrid");

function openTab(id){
  // sections
  Object.values(sections).forEach(s=>s.classList.remove("active"));
  sections[id].classList.add("active");

  // tabs
  Object.values(tabs).forEach(t=>t.classList.remove("active"));
  tabs[id].classList.add("active");

  // per-tab actions
  if(id === "kanji") renderKanjiGrid();
  if(id === "dic") setTimeout(()=>q.focus(), 0);
}

function normalize(s){
  return (s ?? "").toString().trim().toLowerCase();
}

function matchesWord(word, query){
  const qn = normalize(query);
  if(!qn) return true;

  // searchable fields
  const fields = [
    word.jp, word.hira, word.tipo, word.mean,
    ...(word.tags || []),
    ...(word.examples || []).flatMap(e => [e.jp, e.hira, e.pt, e.exp])
  ].map(normalize);

  return fields.some(f => f.includes(qn));
}

function clearSearch(){
  q.value = "";
  renderResults("");
  q.focus();
}

function randomWord(){
  const pool = WORDS;
  if(pool.length === 0) return;
  const pick = pool[Math.floor(Math.random() * pool.length)];
  q.value = pick.jp;
  renderResults(pick.jp);
}

function renderResults(query){
  const text = (query ?? q.value).trim();
  results.innerHTML = "";

  if(!text){
    results.innerHTML = `<div class="card"><div class="mean" style="color:var(--muted)">Digite algo para buscar. Ex.: È£ü„Åπ„Çã / „Åí„Çì„Åç / ‚Äútranquilo‚Äù.</div></div>`;
    return;
  }

  const found = WORDS.filter(w => matchesWord(w, text));

  if(found.length === 0){
    results.innerHTML = `<div class="card"><div class="mean">Nenhum resultado para ‚Äú${escapeHtml(text)}‚Äù.</div><div class="hira">Dica: tente kana („Å≤„Çâ„Åå„Å™), kanji, ou portugu√™s.</div></div>`;
    return;
  }

  found.forEach(w=>{
    const levelBadges = (w.tags || []).map(t=>{
      const low = t.toLowerCase();
      if(low === "n5") return `<span class="badge n5">N5</span>`;
      if(low === "n4") return `<span class="badge n4">N4</span>`;
      return `<span class="badge tag">${escapeHtml(t)}</span>`;
    }).join("");

    const card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
      <div class="jp">${escapeHtml(w.jp)}</div>
      <div class="hira">${escapeHtml(w.hira || "‚Äî")}</div>
      <div class="mean">(${escapeHtml(w.tipo || "‚Äî")}) ‚Äî ${escapeHtml(w.mean || "‚Äî")}</div>
      <div class="badges">${levelBadges}</div>

      ${renderExamples(w.examples || [])}
    `;
    results.appendChild(card);
  });
}

function renderExamples(examples){
  if(!examples.length){
    return `<div class="ex"><h4>Exemplos</h4><div class="exp">Sem exemplos ainda. (Voc√™ pode adicionar 3 aqui.)</div></div>`;
  }
  const exHtml = examples.slice(0,3).map((e, idx)=>`
    <div class="ex">
      <h4>Exemplo ${idx+1}</h4>
      <div class="exline">
        <b>${escapeHtml(e.jp)}</b><br>
        <span class="k">${escapeHtml(e.hira || "")}</span><br>
        ${escapeHtml(e.pt || "")}
      </div>
      <div class="exp"><b>Explica√ß√£o (PT-BR):</b> ${escapeHtml(e.exp || "")}</div>
    </div>
  `).join("");
  return exHtml;
}

function renderKanjiGrid(){
  kanjigrid.innerHTML = "";

  // order N5 first then N4 (already arranged), but just in case:
  const rank = (lvl)=> lvl === "N5" ? 0 : 1;
  const list = [...KANJI_ORDER].sort((a,b)=> rank(a.lvl) - rank(b.lvl));

  list.forEach(item=>{
    const div = document.createElement("div");
    div.className = "kanjiitem";
    div.innerHTML = `
      <div class="k">${escapeHtml(item.k)}</div>
      <div class="lvl"><b>${escapeHtml(item.lvl)}</b> „Éª clique</div>
    `;
    div.addEventListener("click", ()=>{
      openTab("dic");
      q.value = item.k;
      renderResults(item.k);
      window.scrollTo({top:0, behavior:"smooth"});
    });
    kanjigrid.appendChild(div);
  });
}

function escapeHtml(str){
  return (str ?? "").toString()
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

// Events
q.addEventListener("input", ()=> renderResults(q.value));

// init
renderResults("");
</script>

</body>
</html>
