<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ãƒ´ã‚¡ãƒ³ãƒ‘ã‚¤ã‚¢å…¨çŸ¥å…¨èƒ½ è¾å…¸</title>

<style>
:root{
  --bg:#0b0f14;
  --border:#252a36;
  --text:#e6e8ee;
  --muted:#9aa0aa;
  --muted2:#7b8192;

  --accent:#7b5cff;
  --accent2:#36d1dc;
  --accent3:#fb7185;
  --good:#34d399;
  --warn:#f59e0b;

  --radius:16px;
  --shadow: 0 18px 65px rgba(0,0,0,.45);
}

*{box-sizing:border-box}

body{
  background:
    radial-gradient(1200px 700px at 10% 10%, rgba(123,92,255,.22), transparent 55%),
    radial-gradient(900px 600px at 90% 15%, rgba(54,209,220,.16), transparent 55%),
    radial-gradient(900px 650px at 20% 90%, rgba(251,113,133,.12), transparent 55%),
    var(--bg);
  color:var(--text);
  font-family:"Yu Gothic","Hiragino Kaku Gothic ProN",system-ui,sans-serif;
  margin:0;
  line-height:1.95;
}

header{
  position:sticky;
  top:0;
  z-index:10;
  background: rgba(11,15,20,.72);
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
  border-bottom:1px solid var(--border);
}

.topbar{
  max-width:1150px;
  margin:auto;
  padding:18px 18px 12px;
  display:flex;
  gap:18px;
  align-items:flex-start;
  justify-content:space-between;
  flex-wrap:wrap;
}

.brand{min-width:280px;}
.brand .t{
  font-size:20px;
  font-weight:800;
  letter-spacing:1.4px;
}
.brand .s{
  margin-top:6px;
  color:var(--muted);
  font-size:13px;
}
.brand .s span{color:var(--muted2);}

nav{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
  justify-content:flex-end;
}

.tabbtn{
  cursor:pointer;
  border:1px solid var(--border);
  background: rgba(255,255,255,.05);
  color:var(--muted);
  padding:9px 12px;
  border-radius:999px;
  font-size:13px;
  user-select:none;
  transition: transform .08s ease, background .2s ease, color .2s ease, border-color .2s ease;
  box-shadow: var(--shadow);
}
.tabbtn:active{ transform: translateY(1px); }
.tabbtn.active{
  color:var(--text);
  border-color: rgba(54,209,220,.35);
  background: linear-gradient(90deg, rgba(123,92,255,.18), rgba(54,209,220,.15), rgba(251,113,133,.12));
}

.container{
  max-width:1150px;
  margin:auto;
  padding:34px 18px 90px;
}

.section{ display:none; }
.section.active{ display:block; }

.grid{
  display:grid;
  grid-template-columns: 1.15fr .85fr;
  gap:16px;
}
@media (max-width: 980px){ .grid{ grid-template-columns: 1fr; } }

.panel{
  background: rgba(255,255,255,.06);
  border:1px solid var(--border);
  border-radius:22px;
  padding:16px;
  box-shadow: var(--shadow);
}

.panel h2{
  margin: 0 0 8px;
  font-size: 15px;
  letter-spacing:.6px;
}

.hint{
  color:var(--muted);
  font-size:13px;
  margin-top:0;
}

.row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  flex-wrap:wrap;
}

.searchbox{
  margin-top:12px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.searchbox input{
  flex: 1 1 320px;
  padding:12px 14px;
  border-radius:14px;
  border:1px solid var(--border);
  background: rgba(255,255,255,.06);
  color:var(--text);
  outline:none;
}
.searchbox input::placeholder{ color:var(--muted2); }

.toggle{
  display:flex;
  align-items:center;
  gap:8px;
  color:var(--muted);
  font-size:12px;
  user-select:none;
}
.toggle input{ transform: translateY(1px); }

select{
  padding:8px 10px;
  border-radius:12px;
  border:1px solid var(--border);
  background: rgba(255,255,255,.05);
  color: var(--text);
  outline:none;
}

.btn{
  cursor:pointer;
  border:1px solid var(--border);
  background: rgba(255,255,255,.05);
  color:var(--text);
  padding:8px 10px;
  border-radius:12px;
  font-size:12px;
  user-select:none;
}
.btn.primary{
  border-color: rgba(54,209,220,.35);
  background: rgba(54,209,220,.12);
}
.btn.danger{
  border-color: rgba(251,113,133,.35);
  background: rgba(251,113,133,.10);
}
.btn.good{
  border-color: rgba(52,211,153,.35);
  background: rgba(52,211,153,.10);
}
.btn.warn{
  border-color: rgba(245,158,11,.35);
  background: rgba(245,158,11,.10);
}

.card{
  background: rgba(255,255,255,.07);
  border:1px solid var(--border);
  border-radius: var(--radius);
  padding:16px;
  margin-top:12px;
}

.jp{
  font-size:22px;
  font-weight:900;
  letter-spacing:.5px;
  color:var(--accent2);
}
.hira{
  margin-top:6px;
  color:var(--muted);
  font-size:13px;
}
.mean{
  margin-top:8px;
  font-size:14px;
  color:var(--text);
  font-weight:600;
}

.badges{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-top:10px;
}
.badge{
  font-size:11px;
  border:1px solid var(--border);
  padding:3px 8px;
  border-radius:999px;
  color:var(--muted);
}
.badge.n5{ border-color: rgba(52,211,153,.35); color: rgba(52,211,153,.95); }
.badge.tag{ border-color: rgba(54,209,220,.35); color: rgba(54,209,220,.95); }
.badge.warn{ border-color: rgba(245,158,11,.45); color: rgba(245,158,11,.95); }

.ex{
  margin-top:14px;
  padding-top:12px;
  border-top:1px solid rgba(255,255,255,.08);
}
.ex h4{
  margin:0 0 6px;
  font-size:13px;
  color:var(--accent2);
}
.exline{ margin:10px 0 10px; }
.exline b{ color:var(--text); }
.exline .k{ color:var(--accent2); }
.exp{
  color:var(--muted);
  font-size:13px;
  margin-top:6px;
}

.kanjigrid{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(92px, 1fr));
  gap:12px;
  margin-top:12px;
}
.kanjiitem{
  background: rgba(255,255,255,.06);
  border:1px solid var(--border);
  border-radius: 16px;
  padding:12px 10px;
  text-align:center;
  cursor:pointer;
  transition: transform .12s ease, border-color .2s ease;
}
.kanjiitem:hover{
  transform: translateY(-1px);
  border-color: rgba(54,209,220,.28);
}
.kanjiitem .k{
  font-size:28px;
  font-weight:900;
  color:var(--accent2);
}
.kanjiitem .lvl{
  margin-top:6px;
  font-size:11px;
  color:var(--muted);
}
.kanjiitem .lvl b{ color:var(--text); }

.strokeBox{
  margin-top:12px;
  border:1px solid rgba(255,255,255,.08);
  border-radius:16px;
  overflow:hidden;
  background: rgba(255,255,255,.04);
}
.strokeHead{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:10px 12px;
  border-bottom:1px solid rgba(255,255,255,.08);
}
.strokeHead .t{ font-size:13px; color: var(--muted); }
.strokeBody{ padding:12px; }
.strokeBody svg{ width:100%; height:auto; display:block; }
.strokeNote{ color: var(--muted); font-size:12px; margin-top:8px; }

.bigKanji{
  font-size:86px;
  font-weight:900;
  letter-spacing:2px;
  text-align:center;
  color: var(--accent2);
  line-height:1.0;
  margin: 8px 0 6px;
}

hr.sep{
  border:none;
  border-top:1px solid rgba(255,255,255,.08);
  margin:14px 0;
}
.small{
  color:var(--muted);
  font-size:13px;
}
.small b{ color:var(--text); }

.footer{
  text-align:center;
  padding:40px 0 0;
  color:var(--muted);
  font-size:12px;
}

/* Quiz */
.mcGrid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-top:12px;
}
@media (max-width: 820px){ .mcGrid{ grid-template-columns:1fr; } }

.mcBox{
  border:1px solid rgba(255,255,255,.08);
  border-radius:16px;
  padding:12px;
  background: rgba(255,255,255,.04);
}
.mcBox h3{
  margin:0 0 8px;
  font-size:13px;
  color:var(--muted);
  letter-spacing:.6px;
}

.choiceList{ display:grid; gap:8px; }
.choiceBtn{
  text-align:left;
  padding:10px 10px;
  border-radius:14px;
  border:1px solid var(--border);
  background: rgba(255,255,255,.05);
  color: var(--text);
  cursor:pointer;
  transition: transform .08s ease, border-color .2s ease;
}
.choiceBtn:hover{ transform: translateY(-1px); border-color: rgba(54,209,220,.25); }
.choiceBtn.correct{ border-color: rgba(52,211,153,.55); background: rgba(52,211,153,.12); }
.choiceBtn.wrong{ border-color: rgba(251,113,133,.55); background: rgba(251,113,133,.10); }
.choiceBtn:disabled{ opacity:.9; cursor:not-allowed; }

.timerBarWrap{
  width:100%;
  height:10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.05);
  overflow:hidden;
  margin-top:10px;
}
.timerBar{
  height:100%;
  width:100%;
  background: linear-gradient(90deg, rgba(54,209,220,.65), rgba(123,92,255,.55), rgba(251,113,133,.45));
  transition: width .15s linear;
}
</style>
</head>

<body>
<header>
  <div class="topbar">
    <div class="brand">
      <div class="t">ãƒ´ã‚¡ãƒ³ãƒ‘ã‚¤ã‚¢å…¨çŸ¥å…¨èƒ½ è¾å…¸</div>
      <div class="s">Treino focado N5 â†’ (depois N4)</div>
    </div>

    <nav>
      <div class="tabbtn active" id="tab-dic">ğŸ“– DicionÃ¡rio</div>
      <div class="tabbtn" id="tab-kanji">ğŸˆ¶ Kanji</div>
      <div class="tabbtn" id="tab-quiz">ğŸ® Jogo</div>
    </nav>
  </div>
</header>

<div class="container">

  <!-- ====================== DICIONÃRIO ====================== -->
  <section id="dic" class="section active">
    <div class="grid">
      <div class="panel">
        <div class="row">
          <div>
            <h2>DicionÃ¡rio (JP â†’ PT-BR)</h2>
            <p class="hint">Busca ranqueada (exato primeiro). Aceita kanji/kana/portuguÃªs.</p>
          </div>

          <label class="toggle" title="Se existir uma entrada exata, mostra sÃ³ ela.">
            <input type="checkbox" id="onlyExact" />
            sÃ³ exato (quando houver)
          </label>
        </div>

        <div class="searchbox">
          <input id="q" type="text" placeholder="Buscar palavra..." autocomplete="off" />
          <div class="btn danger" id="btnClear">Limpar</div>
        </div>

        <div id="results"></div>
      </div>

      <div class="panel">
        <h2>Fluxo recomendado</h2>
        <p class="small">
          1) Estuda no Kanji (leitura + significado + ordem de traÃ§o).<br>
          2) Vai pro Jogo (mÃºltipla escolha com timer).<br>
          3) O modo inteligente repete o que vocÃª erra (fixaÃ§Ã£o rÃ¡pida).
        </p>
        <hr class="sep" />
        <div class="row">
          <div class="btn" id="btnGoKanji">Ver Kanji</div>
          <div class="btn warn" id="btnGoQuiz">Ir pro Jogo</div>
        </div>
      </div>
    </div>
  </section>

  <!-- ====================== KANJI ====================== -->
  <section id="kanji" class="section">
    <div class="grid">
      <div class="panel">
        <h2>Kanji â€” N5 (ordem completa)</h2>
        <p class="hint">Clique num kanji: mostra leitura/significado + ordem dos traÃ§os.</p>
        <div class="kanjigrid" id="kanjigrid"></div>
      </div>

      <div class="panel">
        <h2>Detalhe</h2>
        <p class="hint">Selecione um kanji na lista.</p>

        <div id="kanjiDetail" class="card" style="display:none;">
          <div class="jp" id="kdKanji"></div>
          <div class="hira" id="kdReadings"></div>
          <div class="mean" id="kdMean"></div>
          <div class="badges" id="kdBadges"></div>

          <div class="strokeBox">
            <div class="strokeHead">
              <div class="t">Ordem dos traÃ§os (Stroke order)</div>
              <div class="btn" id="kdReloadStroke">Recarregar</div>
            </div>
            <div class="strokeBody" id="kdStroke"></div>
            <div class="strokeNote">Carregado online (KanjiVG). Se falhar: Ctrl+F5.</div>
          </div>

          <hr class="sep">
          <div class="row">
            <div class="btn warn" id="kdGoQuiz">Treinar no Jogo</div>
          </div>
        </div>

        <div id="kanjiDetailEmpty" class="card">
          <div class="mean" style="color:var(--muted);">Clique em um kanji para ver detalhes aqui.</div>
        </div>
      </div>
    </div>
  </section>

  <!-- ====================== QUIZ ====================== -->
  <section id="quiz" class="section">
    <div class="grid">
      <div class="panel">
        <div class="row">
          <div>
            <h2>Jogo â€” mÃºltipla escolha + timer</h2>
            <p class="hint">Acerta 2/2 (Leitura + Significado) pra pontuar como acerto.</p>
          </div>

          <div class="row">
            <label class="toggle" title="Repete mais os kanji que vocÃª erra.">
              <input type="checkbox" id="quizSmart" checked />
              modo inteligente
            </label>
          </div>
        </div>

        <div class="card">
          <div class="row" style="align-items:flex-end;">
            <div style="flex:1;">
              <div class="bigKanji" id="quizKanji">ä¸€</div>
              <div class="badges" style="justify-content:center;">
                <span class="badge" id="quizScore">Acertos: 0 Â· Erros: 0 Â· Streak: 0</span>
                <span class="badge warn" id="quizTimerText">â±ï¸ 12s</span>
              </div>
              <div class="timerBarWrap">
                <div class="timerBar" id="timerBar"></div>
              </div>
            </div>

            <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;">
              <div class="small">Tempo</div>
              <select id="quizTime">
                <option value="8">8s</option>
                <option value="12" selected>12s</option>
                <option value="18">18s</option>
                <option value="25">25s</option>
              </select>
              <div class="btn good" id="quizStart">Start</div>
              <div class="btn" id="quizPause">Pausar</div>
              <div class="btn warn" id="quizNext">PrÃ³ximo</div>
              <div class="btn danger" id="quizReset">Zerar</div>
            </div>
          </div>

          <hr class="sep">

          <div class="mcGrid">
            <div class="mcBox">
              <h3>Leituras (escolha 1)</h3>
              <div class="choiceList" id="readingChoices"></div>
            </div>

            <div class="mcBox">
              <h3>Significados (PT-BR) (escolha 1)</h3>
              <div class="choiceList" id="meaningChoices"></div>
            </div>
          </div>

          <div id="quizFeedback" class="card" style="display:none;">
            <div class="mean" id="quizFeedbackTitle"></div>
            <div class="hira" id="quizFeedbackDetail"></div>

            <div class="strokeBox" style="margin-top:12px;">
              <div class="strokeHead">
                <div class="t">Ordem dos traÃ§os (Stroke order)</div>
                <div class="btn" id="quizReloadStroke">Recarregar</div>
              </div>
              <div class="strokeBody" id="quizStroke"></div>
              <div class="strokeNote">Carregado online (KanjiVG).</div>
            </div>
          </div>
        </div>
      </div>

      <div class="panel">
        <h2>Ranking + EstatÃ­sticas (local)</h2>
        <p class="hint">Salva no seu navegador (localStorage).</p>

        <div class="card">
          <div class="mean">ğŸ† Melhores marcas</div>
          <div class="small" id="bestStats">â€”</div>
          <hr class="sep">
          <div class="mean">ğŸ“Š Top kanji mais errados</div>
          <div class="small" id="worstKanjis">â€”</div>
          <hr class="sep">
          <div class="small">
            â€¢ Se quiser, depois eu adiciono â€œmodo 2 fasesâ€ e â€œmÃºltipla escolha hardâ€ (8 opÃ§Ãµes).<br>
            â€¢ TambÃ©m dÃ¡ pra colocar â€œresetar histÃ³ricoâ€ por botÃ£o.
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="footer">ãƒ´ã‚¡ãƒ³ãƒ‘ã‚¤ã‚¢å…¨çŸ¥å…¨èƒ½ Â© 2025</div>
</div>

<script>
/* =========================
   DADOS
   ========================= */
const WORDS = [
  {
    jp:"é£Ÿã¹ã‚‹", hira:"ãŸã¹ã‚‹", tipo:"verbo (ichidan)", mean:"comer", tags:["N5","cotidiano"],
    examples:[
      { jp:"æœã”ã¯ã‚“ã‚’é£Ÿã¹ã¾ã—ãŸã€‚", hira:"ã‚ã•ã”ã¯ã‚“ ã‚’ ãŸã¹ã¾ã—ãŸã€‚", pt:"Comi cafÃ© da manhÃ£.", exp:"æœã”ã¯ã‚“ = cafÃ© da manhÃ£; ã‚’ = objeto; ã€œã¾ã—ãŸ = passado polido." },
      { jp:"ä½•ã‚’é£Ÿã¹ãŸã„ã§ã™ã‹ï¼Ÿ", hira:"ãªã« ã‚’ ãŸã¹ãŸã„ ã§ã™ ã‹ï¼Ÿ", pt:"O que vocÃª quer comer?", exp:"ã€œãŸã„ = querer; ã§ã™ã‹ = pergunta educada." },
      { jp:"å‹ã ã¡ã¨æ˜¼ã”ã¯ã‚“ã‚’é£Ÿã¹ã«è¡Œãã¾ã™ã€‚", hira:"ã¨ã‚‚ã ã¡ ã¨ ã²ã‚‹ã”ã¯ã‚“ ã‚’ ãŸã¹ ã« ã„ãã¾ã™ã€‚", pt:"Vou almoÃ§ar com um amigo.", exp:"Vã¾ã™-stem + ã«è¡Œã = ir para fazer algo (é£Ÿã¹ã¾ã™â†’é£Ÿã¹)." }
    ]
  }
];

const KANJI_ORDER_N5 = [
  "ä¸€","ä¸ƒ","ä¸‡","ä¸‰","ä¸Š","ä¸‹","ä¸­","ä¹","äºŒ","äº”","äºº","ä»Š","ä¼‘","ä½•","å…ˆ","å…¥","å…«","å…­","å††","å‡º","åˆ†","å‰","åŒ—","å","åƒ","åˆ","åŠ","å—","å‹","å³","å","å››","å›½","åœŸ","å¤–","å¤§","å¤©","å¥³","å­","å­¦","å°","å±±","å·","å·¦","å¹´","å¾Œ","æ—¥","æ™‚","æ›¸","æœˆ","æœ¨","æœ¬","æ¥","æ±","æ ¡","æ¯","æ¯","æ°—","æ°´","ç«","çˆ¶","ç”Ÿ","ç”·","ç™½","ç™¾","è","è¡Œ","è¥¿","è¦‹","è©±","èª","èª­","è»Š","é‡‘","é•·","é–“","é›¨","é›»","é£Ÿ","é«˜"
];

const KANJI_INFO = {
  "ä¸€":{lvl:"N5", readings:["ã„ã¡","ã²ã¨"], meanings:["um","1"]},
  "ä¸ƒ":{lvl:"N5", readings:["ã—ã¡","ãªãª"], meanings:["sete","7"]},
  "ä¸‡":{lvl:"N5", readings:["ã¾ã‚“"], meanings:["dez mil","10000","10 mil"]},
  "ä¸‰":{lvl:"N5", readings:["ã•ã‚“","ã¿ã£"], meanings:["trÃªs","3"]},
  "ä¸Š":{lvl:"N5", readings:["ã˜ã‚‡ã†","ã†ãˆ","ã‚"], meanings:["cima","acima","superior"]},
  "ä¸‹":{lvl:"N5", readings:["ã‹","ã—ãŸ","ã•"], meanings:["baixo","abaixo","inferior"]},
  "ä¸­":{lvl:"N5", readings:["ã¡ã‚…ã†","ãªã‹"], meanings:["meio","dentro","centro"]},
  "ä¹":{lvl:"N5", readings:["ãã‚…ã†","ã“ã“ã®"], meanings:["nove","9"]},
  "äºŒ":{lvl:"N5", readings:["ã«","ãµãŸ"], meanings:["dois","2"]},
  "äº”":{lvl:"N5", readings:["ã”","ã„ã¤"], meanings:["cinco","5"]},
  "äºº":{lvl:"N5", readings:["ã˜ã‚“","ã«ã‚“","ã²ã¨"], meanings:["pessoa","gente","humano"]},
  "ä»Š":{lvl:"N5", readings:["ã“ã‚“","ã„ã¾"], meanings:["agora","atualmente"]},
  "ä¼‘":{lvl:"N5", readings:["ãã‚…ã†","ã‚„ã™"], meanings:["descansar","folga","feriado","pausa"]},
  "ä½•":{lvl:"N5", readings:["ãªã‚“","ãªã«"], meanings:["o que","qual"]},
  "å…ˆ":{lvl:"N5", readings:["ã›ã‚“","ã•ã"], meanings:["antes","anterior","frente","ponta"]},
  "å…¥":{lvl:"N5", readings:["ã«ã‚…ã†","ã„"], meanings:["entrar","entrada","inserir"]},
  "å…«":{lvl:"N5", readings:["ã¯ã¡","ã‚„"], meanings:["oito","8"]},
  "å…­":{lvl:"N5", readings:["ã‚ã","ã‚€"], meanings:["seis","6"]},
  "å††":{lvl:"N5", readings:["ãˆã‚“"], meanings:["iene","yen","cÃ­rculo"]},
  "å‡º":{lvl:"N5", readings:["ã—ã‚…ã¤","ã§","ã "], meanings:["sair","saÃ­da","aparecer","tirar"]},
  "åˆ†":{lvl:"N5", readings:["ã¶ã‚“","ãµã‚“","ã‚"], meanings:["minuto","parte","entender"]},
  "å‰":{lvl:"N5", readings:["ãœã‚“","ã¾ãˆ"], meanings:["antes","frente","anterior"]},
  "åŒ—":{lvl:"N5", readings:["ã»ã","ããŸ"], meanings:["norte"]},
  "å":{lvl:"N5", readings:["ã˜ã‚…ã†","ã¨ãŠ"], meanings:["dez","10"]},
  "åƒ":{lvl:"N5", readings:["ã›ã‚“","ã¡"], meanings:["mil","1000"]},
  "åˆ":{lvl:"N5", readings:["ã”"], meanings:["meio-dia","am/pm"]},
  "åŠ":{lvl:"N5", readings:["ã¯ã‚“"], meanings:["metade","meia"]},
  "å—":{lvl:"N5", readings:["ãªã‚“","ã¿ãªã¿"], meanings:["sul"]},
  "å‹":{lvl:"N5", readings:["ã‚†ã†","ã¨ã‚‚"], meanings:["amigo"]},
  "å³":{lvl:"N5", readings:["ã†","ã¿ã"], meanings:["direita"]},
  "å":{lvl:"N5", readings:["ã‚ã„","ãª"], meanings:["nome","fama"]},
  "å››":{lvl:"N5", readings:["ã—","ã‚ˆã‚“","ã‚ˆ"], meanings:["quatro","4"]},
  "å›½":{lvl:"N5", readings:["ã“ã","ãã«"], meanings:["paÃ­s","naÃ§Ã£o"]},
  "åœŸ":{lvl:"N5", readings:["ã©","ã¤ã¡"], meanings:["terra","solo","sÃ¡bado"]},
  "å¤–":{lvl:"N5", readings:["ãŒã„","ãã¨","ã¯ãš"], meanings:["fora","exterior"]},
  "å¤§":{lvl:"N5", readings:["ã ã„","ãŠãŠ"], meanings:["grande"]},
  "å¤©":{lvl:"N5", readings:["ã¦ã‚“","ã‚ã¾"], meanings:["cÃ©u"]},
  "å¥³":{lvl:"N5", readings:["ã˜ã‚‡","ãŠã‚“ãª"], meanings:["mulher","feminino"]},
  "å­":{lvl:"N5", readings:["ã—","ã“"], meanings:["crianÃ§a","filho"]},
  "å­¦":{lvl:"N5", readings:["ãŒã","ã¾ãª"], meanings:["estudo","aprender","escola"]},
  "å°":{lvl:"N5", readings:["ã—ã‚‡ã†","ã¡ã„"], meanings:["pequeno"]},
  "å±±":{lvl:"N5", readings:["ã•ã‚“","ã‚„ã¾"], meanings:["montanha"]},
  "å·":{lvl:"N5", readings:["ã›ã‚“","ã‹ã‚"], meanings:["rio"]},
  "å·¦":{lvl:"N5", readings:["ã•","ã²ã ã‚Š"], meanings:["esquerda"]},
  "å¹´":{lvl:"N5", readings:["ã­ã‚“","ã¨ã—"], meanings:["ano"]},
  "å¾Œ":{lvl:"N5", readings:["ã”","ã®ã¡","ã†ã—"], meanings:["depois","atrÃ¡s"]},
  "æ—¥":{lvl:"N5", readings:["ã«ã¡","ã˜ã¤","ã²"], meanings:["dia","sol"]},
  "æ™‚":{lvl:"N5", readings:["ã˜","ã¨ã"], meanings:["hora","tempo"]},
  "æ›¸":{lvl:"N5", readings:["ã—ã‚‡","ã‹"], meanings:["escrever","livro"]},
  "æœˆ":{lvl:"N5", readings:["ã’ã¤","ãŒã¤","ã¤ã"], meanings:["mÃªs","lua"]},
  "æœ¨":{lvl:"N5", readings:["ã‚‚ã","ã¼ã","ã"], meanings:["Ã¡rvore","madeira"]},
  "æœ¬":{lvl:"N5", readings:["ã»ã‚“","ã‚‚ã¨"], meanings:["livro","origem"]},
  "æ¥":{lvl:"N5", readings:["ã‚‰ã„","ã","ã“"], meanings:["vir","prÃ³ximo"]},
  "æ±":{lvl:"N5", readings:["ã¨ã†","ã²ãŒã—"], meanings:["leste"]},
  "æ ¡":{lvl:"N5", readings:["ã“ã†"], meanings:["escola"]},
  "æ¯":{lvl:"N5", readings:["ã¼","ã¯ã¯"], meanings:["mÃ£e"]},
  "æ¯":{lvl:"N5", readings:["ã¾ã„"], meanings:["todo","cada"]},
  "æ°—":{lvl:"N5", readings:["ã","ã‘"], meanings:["energia","ar","espÃ­rito","clima","humor"]},
  "æ°´":{lvl:"N5", readings:["ã™ã„","ã¿ãš"], meanings:["Ã¡gua","quarta"]},
  "ç«":{lvl:"N5", readings:["ã‹","ã²"], meanings:["fogo","terÃ§a"]},
  "çˆ¶":{lvl:"N5", readings:["ãµ","ã¡ã¡"], meanings:["pai"]},
  "ç”Ÿ":{lvl:"N5", readings:["ã›ã„","ã—ã‚‡ã†","ã„","ã†","ãªã¾"], meanings:["vida","nascer","cru","aluno"]},
  "ç”·":{lvl:"N5", readings:["ã ã‚“","ãŠã¨ã“"], meanings:["homem","masculino"]},
  "ç™½":{lvl:"N5", readings:["ã¯ã","ã—ã‚"], meanings:["branco"]},
  "ç™¾":{lvl:"N5", readings:["ã²ã‚ƒã"], meanings:["cem","100"]},
  "è":{lvl:"N5", readings:["ã¶ã‚“","ã‚‚ã‚“","ã"], meanings:["ouvir","perguntar"]},
  "è¡Œ":{lvl:"N5", readings:["ã“ã†","ãã‚‡ã†","ã„","ã‚†"], meanings:["ir","linha","fazer"]},
  "è¥¿":{lvl:"N5", readings:["ã›ã„","ã«ã—"], meanings:["oeste"]},
  "è¦‹":{lvl:"N5", readings:["ã‘ã‚“","ã¿"], meanings:["ver","olhar","assistir"]},
  "è©±":{lvl:"N5", readings:["ã‚","ã¯ãª"], meanings:["falar","conversa","histÃ³ria"]},
  "èª":{lvl:"N5", readings:["ã”","ã‹ãŸ"], meanings:["lÃ­ngua","idioma","palavra"]},
  "èª­":{lvl:"N5", readings:["ã©ã","ã‚ˆ"], meanings:["ler"]},
  "è»Š":{lvl:"N5", readings:["ã—ã‚ƒ","ãã‚‹ã¾"], meanings:["carro","veÃ­culo"]},
  "é‡‘":{lvl:"N5", readings:["ãã‚“","ã‹ã­"], meanings:["dinheiro","ouro","sexta"]},
  "é•·":{lvl:"N5", readings:["ã¡ã‚‡ã†","ãªãŒ"], meanings:["longo","chefe"]},
  "é–“":{lvl:"N5", readings:["ã‹ã‚“","ã‘ã‚“","ã‚ã„ã ","ã¾"], meanings:["entre","intervalo","tempo"]},
  "é›¨":{lvl:"N5", readings:["ã†","ã‚ã‚"], meanings:["chuva"]},
  "é›»":{lvl:"N5", readings:["ã§ã‚“"], meanings:["eletricidade"]},
  "é£Ÿ":{lvl:"N5", readings:["ã—ã‚‡ã","ãŸ"], meanings:["comer","comida"]},
  "é«˜":{lvl:"N5", readings:["ã“ã†","ãŸã‹"], meanings:["alto","caro"]}
};

/* =========================
   HELPERS
   ========================= */
function $(id){ return document.getElementById(id); }

function escapeHtml(str){
  return (str ?? "").toString()
    .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
    .replaceAll('"',"&quot;").replaceAll("'","&#039;");
}
function normalize(s){
  return (s ?? "")
    .toString().trim().toLowerCase()
    .replace(/[\sã€€]+/g, "")
    .replace(/[ã€‚ã€ï¼Œ,.!?ï¼ï¼Ÿã€Œã€ã€ã€ï¼ˆï¼‰()ã€ã€‘\[\]""'â€™]/g, "");
}
function shuffle(arr){
  const a = [...arr];
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}
function uniqByText(opts){
  const seen = new Set();
  const out = [];
  for(const o of opts){
    if(seen.has(o.text)) continue;
    seen.add(o.text);
    out.push(o);
  }
  return out;
}

/* =========================
   TABS (SEM SOBRE)
   ========================= */
const sections = {
  dic: $("dic"),
  kanji: $("kanji"),
  quiz: $("quiz"),
};
const tabs = {
  dic: $("tab-dic"),
  kanji: $("tab-kanji"),
  quiz: $("tab-quiz"),
};

function openTab(id){
  Object.values(sections).forEach(s=>s.classList.remove("active"));
  Object.values(tabs).forEach(t=>t.classList.remove("active"));
  sections[id].classList.add("active");
  tabs[id].classList.add("active");
  if(id==="kanji") renderKanjiGrid();
}

/* =========================
   DICIONÃRIO
   ========================= */
const q = $("q");
const results = $("results");
const onlyExactEl = $("onlyExact");

function isExactHeadword(word, qNorm){
  return normalize(word.jp)===qNorm || normalize(word.hira)===qNorm || normalize(word.mean)===qNorm;
}
function scoreWord(word, qNorm){
  const jp = normalize(word.jp), hira = normalize(word.hira), mean = normalize(word.mean);
  if(jp===qNorm) return 1000;
  if(hira===qNorm) return 950;
  if(mean===qNorm) return 900;
  if(jp.startsWith(qNorm)) return 780;
  if(hira.startsWith(qNorm)) return 740;
  if(mean.startsWith(qNorm)) return 700;
  if(jp.includes(qNorm)) return 520;
  if(hira.includes(qNorm)) return 500;
  if(mean.includes(qNorm)) return 480;
  return 0;
}
function renderExamples(examples){
  if(!examples?.length) return "";
  return examples.slice(0,3).map((e, idx)=>`
    <div class="ex">
      <h4>Exemplo ${idx+1}</h4>
      <div class="exline">
        <b>${escapeHtml(e.jp || "")}</b><br>
        <span class="k">${escapeHtml(e.hira || "")}</span><br>
        ${escapeHtml(e.pt || "")}
      </div>
      <div class="exp"><b>ExplicaÃ§Ã£o (PT-BR):</b> ${escapeHtml(e.exp || "")}</div>
    </div>
  `).join("");
}
function renderResults(raw){
  const query = (raw ?? q.value).trim();
  results.innerHTML = "";

  if(!query){
    results.innerHTML = `<div class="card"><div class="mean" style="color:var(--muted)">Digite algo para buscar.</div></div>`;
    return;
  }

  const qNorm = normalize(query);
  const ranked = WORDS
    .map(w => ({ w, s: scoreWord(w, qNorm) }))
    .filter(x => x.s > 0)
    .sort((a,b)=> b.s - a.s);

  if(!ranked.length){
    results.innerHTML = `<div class="card"><div class="mean">Nenhum resultado para â€œ${escapeHtml(query)}â€.</div></div>`;
    return;
  }

  const exact = ranked.filter(x => isExactHeadword(x.w, qNorm));
  const nonExact = ranked.filter(x => !isExactHeadword(x.w, qNorm));
  const finalList = exact.length
    ? (onlyExactEl.checked ? exact : [...exact, ...nonExact])
    : ranked;

  const header = document.createElement("div");
  header.className="card";
  header.innerHTML = `<div class="mean">Busca: <b>${escapeHtml(query)}</b> â€” resultados: <b>${finalList.length}</b></div>`;
  results.appendChild(header);

  finalList.slice(0,10).forEach(({w})=>{
    const card = document.createElement("div");
    card.className="card";
    card.innerHTML = `
      <div class="jp">${escapeHtml(w.jp)}</div>
      <div class="hira">${escapeHtml(w.hira || "â€”")}</div>
      <div class="mean">(${escapeHtml(w.tipo || "â€”")}) â€” ${escapeHtml(w.mean || "â€”")}</div>
      ${renderExamples(w.examples || [])}
    `;
    results.appendChild(card);
  });
}

let deb=null;
q.addEventListener("input", ()=>{
  clearTimeout(deb);
  deb = setTimeout(()=>renderResults(q.value), 80);
});
onlyExactEl.addEventListener("change", ()=> renderResults(q.value));

$("btnClear").addEventListener("click", ()=>{
  q.value=""; renderResults(""); q.focus();
});
$("btnGoKanji").addEventListener("click", ()=> openTab("kanji"));
$("btnGoQuiz").addEventListener("click", ()=> openTab("quiz"));

/* =========================
   STROKE ORDER (KanjiVG)
   ========================= */
function codepointHex5(ch){
  return ch.codePointAt(0).toString(16).padStart(5,"0");
}
async function loadKanjiStrokeSVG(kanji, targetEl){
  const hex = codepointHex5(kanji);
  const url = `https://cdn.jsdelivr.net/gh/KanjiVG/kanjivg@master/kanji/${hex}.svg`;
  targetEl.innerHTML = `<div class="small">Carregando stroke order...</div>`;
  try{
    const res = await fetch(url, {cache:"force-cache"});
    if(!res.ok) throw new Error("HTTP "+res.status);
    const svgText = await res.text();
    const cleaned = svgText
      .replace(/width="[^"]*"/g,'')
      .replace(/height="[^"]*"/g,'')
      .replace(/<\?xml[^>]*\?>/g,'');
    targetEl.innerHTML = cleaned;
  }catch{
    targetEl.innerHTML = `<div class="small">Falha ao carregar. Use Ctrl+F5 e tente novamente.</div>`;
  }
}

/* =========================
   KANJI TAB
   ========================= */
const kanjigrid = $("kanjigrid");
const kdBox = $("kanjiDetail");
const kdEmpty = $("kanjiDetailEmpty");
const kdKanji = $("kdKanji");
const kdReadings = $("kdReadings");
const kdMean = $("kdMean");
const kdBadges = $("kdBadges");
const kdStroke = $("kdStroke");
let currentKanji = null;

function renderKanjiGrid(){
  kanjigrid.innerHTML = "";
  KANJI_ORDER_N5.forEach(k=>{
    const div = document.createElement("div");
    div.className = "kanjiitem";
    div.innerHTML = `<div class="k">${escapeHtml(k)}</div><div class="lvl"><b>N5</b> ãƒ» clique</div>`;
    div.addEventListener("click", ()=> showKanjiDetail(k));
    kanjigrid.appendChild(div);
  });
}

function showKanjiDetail(k){
  currentKanji = k;
  const info = KANJI_INFO[k];

  kdEmpty.style.display="none";
  kdBox.style.display="block";

  kdKanji.textContent = k;
  kdReadings.textContent = `Leituras: ${info?.readings?.join(" / ") || "â€”"}`;
  kdMean.textContent = `Significado (PT): ${info?.meanings?.join(" / ") || "â€”"}`;
  kdBadges.innerHTML = `<span class="badge n5">N5</span><span class="badge tag">kanji</span>`;

  loadKanjiStrokeSVG(k, kdStroke);
}

$("kdReloadStroke").addEventListener("click", ()=>{
  if(currentKanji) loadKanjiStrokeSVG(currentKanji, kdStroke);
});
$("kdGoQuiz").addEventListener("click", ()=>{
  if(!currentKanji) return;
  openTab("quiz");
  setQuizKanji(currentKanji, true);
});

/* =========================
   QUIZ (mÃºltipla escolha + timer)
   ========================= */
const quizSmart = $("quizSmart");
const quizKanji = $("quizKanji");
const quizScoreEl = $("quizScore");
const quizTimerText = $("quizTimerText");
const timerBar = $("timerBar");

const quizTime = $("quizTime");
const quizStart = $("quizStart");
const quizPause = $("quizPause");
const quizNext = $("quizNext");
const quizReset = $("quizReset");

const readingChoices = $("readingChoices");
const meaningChoices = $("meaningChoices");

const quizFeedback = $("quizFeedback");
const quizFeedbackTitle = $("quizFeedbackTitle");
const quizFeedbackDetail = $("quizFeedbackDetail");
const quizStroke = $("quizStroke");
$("quizReloadStroke").addEventListener("click", ()=>{
  loadKanjiStrokeSVG(quizState.current, quizStroke);
});

const bestStatsEl = $("bestStats");
const worstKanjisEl = $("worstKanjis");

const LS_KEY = "vampire_znzn_quiz_stats_v2";

function loadStats(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    return raw ? JSON.parse(raw) : null;
  }catch{ return null; }
}
function saveStats(data){
  try{ localStorage.setItem(LS_KEY, JSON.stringify(data)); }catch{}
}
function defaultStats(){
  return {
    bestStreak: 0,
    bestAccuracy: 0,
    bestScore: 0,
    totalCorrect: 0,
    totalWrong: 0,
    perKanji: {}
  };
}
let stats = loadStats() || defaultStats();

function ensurePerKanji(k){
  if(!stats.perKanji[k]) stats.perKanji[k] = {c:0,w:0};
}

const quizState = {
  current: "ä¸€",
  correct: 0,
  wrong: 0,
  streak: 0,

  running: false,
  timerId: null,
  timeLeftMs: 12000,
  timeTotalMs: 12000,

  answeredReading: false,
  answeredMeaning: false,
  chosenReadingOk: false,
  chosenMeaningOk: false,
};

function updateScoreUI(){
  quizScoreEl.textContent = `Acertos: ${quizState.correct} Â· Erros: ${quizState.wrong} Â· Streak: ${quizState.streak}`;
}
function updateBestUI(){
  const total = stats.totalCorrect + stats.totalWrong;
  const acc = total ? (stats.totalCorrect / total) : 0;
  bestStatsEl.innerHTML = `
    â€¢ Best streak: <b>${stats.bestStreak}</b><br>
    â€¢ Best accuracy: <b>${Math.round(stats.bestAccuracy*100)}%</b><br>
    â€¢ Best score (Câˆ’E): <b>${stats.bestScore}</b><br>
    â€¢ Global accuracy: <b>${Math.round(acc*100)}%</b> (C:${stats.totalCorrect} / E:${stats.totalWrong})
  `;
}
function updateWorstUI(){
  const arr = Object.entries(stats.perKanji).map(([k,v])=>{
    const total = v.c + v.w;
    const err = total ? (v.w / total) : 0;
    return {k, c:v.c, w:v.w, total, err};
  }).filter(x=>x.total>0);

  arr.sort((a,b)=> (b.w - a.w) || (b.err - a.err));
  const top = arr.slice(0,10);
  if(!top.length){ worstKanjisEl.textContent="â€”"; return; }
  worstKanjisEl.innerHTML = top.map(x=>{
    const pct = Math.round(x.err*100);
    return `â€¢ <b>${escapeHtml(x.k)}</b> â€” erros: ${x.w} / ${x.total} (${pct}%)`;
  }).join("<br>");
}
function updateAndPersistBests(){
  stats.bestStreak = Math.max(stats.bestStreak, quizState.streak);

  const total = quizState.correct + quizState.wrong;
  const acc = total ? (quizState.correct / total) : 0;
  const score = quizState.correct - quizState.wrong;

  stats.bestAccuracy = Math.max(stats.bestAccuracy, acc);
  stats.bestScore = Math.max(stats.bestScore, score);

  saveStats(stats);
  updateBestUI();
  updateWorstUI();
}

function showFeedback(scored, okAll){
  quizFeedback.style.display = "block";
  const k = quizState.current;
  const info = KANJI_INFO[k];
  const r = info ? info.readings.join(" / ") : "â€”";
  const m = info ? info.meanings.join(" / ") : "â€”";

  quizFeedbackTitle.innerHTML = scored
    ? (okAll ? `âœ… <b>Acertou!</b> (2/2)` : `âŒ <b>Errou.</b>`)
    : `ğŸ‘ï¸ <b>Revelado</b>`;

  quizFeedbackDetail.innerHTML = `
    Kanji: <b>${escapeHtml(k)}</b><br>
    Leituras: <b>${escapeHtml(r)}</b><br>
    Significados: <b>${escapeHtml(m)}</b>
  `;

  loadKanjiStrokeSVG(k, quizStroke);
}
function hideFeedback(){
  quizFeedback.style.display = "none";
  quizFeedbackTitle.textContent = "";
  quizFeedbackDetail.textContent = "";
}

function makeReadingText(k){
  return (KANJI_INFO[k]?.readings || ["â€”"]).join(" / ");
}
function makeMeaningText(k){
  return (KANJI_INFO[k]?.meanings || ["â€”"]).join(" / ");
}

function buildChoices(kind, correctKanji){
  const pool = KANJI_ORDER_N5.filter(k => k !== correctKanji);
  const distractors = shuffle(pool).slice(0, 10);

  const correctText = (kind==="reading") ? makeReadingText(correctKanji) : makeMeaningText(correctKanji);
  const correct = { text: correctText, correct: true };

  let opts = [correct, ...distractors.map(k=>{
    const text = (kind==="reading") ? makeReadingText(k) : makeMeaningText(k);
    return { text, correct:false };
  })];

  opts = uniqByText(opts);
  if(!opts.some(o=>o.correct)) opts.unshift(correct);

  // garante 4
  opts = opts.slice(0,4);
  while(opts.length < 4){
    const k = pool[Math.floor(Math.random()*pool.length)];
    const text = (kind==="reading") ? makeReadingText(k) : makeMeaningText(k);
    if(opts.some(o=>o.text===text)) continue;
    opts.push({text, correct:false});
  }
  return shuffle(opts);
}

function resetQuestionState(){
  quizState.answeredReading = false;
  quizState.answeredMeaning = false;
  quizState.chosenReadingOk = false;
  quizState.chosenMeaningOk = false;
  hideFeedback();
}

function renderChoiceButtons(targetEl, options, onPick){
  targetEl.innerHTML = "";
  options.forEach(opt=>{
    const b = document.createElement("button");
    b.type = "button";
    b.className = "choiceBtn";
    b.textContent = opt.text;
    b.addEventListener("click", ()=>{
      // desabilita todos nesse bloco
      const btns = Array.from(targetEl.querySelectorAll(".choiceBtn"));
      btns.forEach(btn=> btn.disabled = true);

      // mostra qual era o correto
      btns.forEach((btn, idx)=>{
        if(options[idx].correct) btn.classList.add("correct");
      });

      // marca clique
      if(opt.correct) b.classList.add("correct");
      else b.classList.add("wrong");

      onPick(opt.correct);
    });
    targetEl.appendChild(b);
  });
}

function evaluateIfComplete(){
  if(!(quizState.answeredReading && quizState.answeredMeaning)) return;

  const okAll = quizState.chosenReadingOk && quizState.chosenMeaningOk;
  const k = quizState.current;
  ensurePerKanji(k);

  if(okAll){
    quizState.correct += 1;
    quizState.streak += 1;
    stats.totalCorrect += 1;
    stats.perKanji[k].c += 1;
  }else{
    quizState.wrong += 1;
    quizState.streak = 0;
    stats.totalWrong += 1;
    stats.perKanji[k].w += 1;
  }

  updateScoreUI();
  updateAndPersistBests();
  showFeedback(true, okAll);

  stopTimer();
  setTimeout(()=> nextQuestion(true), 800);
}

function weightedPick(pool){
  let total = 0;
  const weights = pool.map(k=>{
    ensurePerKanji(k);
    const {c,w} = stats.perKanji[k];
    const unseen = (c+w===0) ? 0.8 : 0;
    const weight = Math.max(0.2, 1 + w*2 - c*0.35 + unseen);
    total += weight;
    return weight;
  });

  let r = Math.random() * total;
  for(let i=0;i<pool.length;i++){
    r -= weights[i];
    if(r <= 0) return pool[i];
  }
  return pool[pool.length-1];
}

function pickKanji(){
  const pool = KANJI_ORDER_N5;
  if(!quizSmart.checked) return pool[Math.floor(Math.random()*pool.length)];
  return weightedPick(pool);
}

function setQuizKanji(k, keepTimerRunning){
  quizState.current = k;
  quizKanji.textContent = k;

  resetQuestionState();

  const rOpts = buildChoices("reading", k);
  const mOpts = buildChoices("meaning", k);

  renderChoiceButtons(readingChoices, rOpts, (ok)=>{
    quizState.answeredReading = true;
    quizState.chosenReadingOk = ok;
    evaluateIfComplete();
  });

  renderChoiceButtons(meaningChoices, mOpts, (ok)=>{
    quizState.answeredMeaning = true;
    quizState.chosenMeaningOk = ok;
    evaluateIfComplete();
  });

  if(quizState.running){
    // reinicia timer para nova pergunta
    startTimer(true);
  }else if(!keepTimerRunning){
    // quando entra no jogo sem rodar, sÃ³ seta barra
    const seconds = Number(quizTime.value);
    quizState.timeTotalMs = seconds*1000;
    quizState.timeLeftMs = quizState.timeTotalMs;
    updateTimerUI();
  }
}

function nextQuestion(auto){
  const k = auto ? pickKanji() : pickKanji();
  setQuizKanji(k, true);
}

/* Timer (um Ãºnico interval ativo) */
function updateTimerUI(){
  const leftSec = Math.max(0, Math.ceil(quizState.timeLeftMs/1000));
  quizTimerText.textContent = `â±ï¸ ${leftSec}s`;
  const pct = quizState.timeTotalMs ? (quizState.timeLeftMs/quizState.timeTotalMs) : 0;
  timerBar.style.width = `${Math.max(0, Math.min(1, pct))*100}%`;
}

function stopTimer(){
  if(quizState.timerId){
    clearInterval(quizState.timerId);
    quizState.timerId = null;
  }
  quizState.running = false;
}

function startTimer(reset){
  const seconds = Number(quizTime.value);
  quizState.timeTotalMs = seconds*1000;
  if(reset) quizState.timeLeftMs = quizState.timeTotalMs;

  stopTimer(); // garante que nunca duplica interval
  quizState.running = true;

  quizState.timerId = setInterval(()=>{
    quizState.timeLeftMs -= 200;
    updateTimerUI();

    if(quizState.timeLeftMs <= 0){
      // timeout: erro 1 vez, trava tudo e avanÃ§a
      stopTimer();

      const k = quizState.current;
      ensurePerKanji(k);

      quizState.wrong += 1;
      quizState.streak = 0;
      stats.totalWrong += 1;
      stats.perKanji[k].w += 1;

      updateScoreUI();
      updateAndPersistBests();
      showFeedback(true, false);

      // trava botÃµes
      document.querySelectorAll(".choiceBtn").forEach(b=> b.disabled = true);

      setTimeout(()=> nextQuestion(true), 900);
    }
  }, 200);

  updateTimerUI();
}

/* =========================
   EVENTOS
   ========================= */
tabs.dic.addEventListener("click", ()=> openTab("dic"));
tabs.kanji.addEventListener("click", ()=> openTab("kanji"));
tabs.quiz.addEventListener("click", ()=> openTab("quiz"));

quizStart.addEventListener("click", ()=> startTimer(true));
quizPause.addEventListener("click", ()=>{
  if(quizState.running) stopTimer();
  else startTimer(false);
});
quizNext.addEventListener("click", ()=> nextQuestion(true));
quizReset.addEventListener("click", ()=>{
  stopTimer();
  quizState.correct = 0;
  quizState.wrong = 0;
  quizState.streak = 0;
  updateScoreUI();
  nextQuestion(true);
});
quizTime.addEventListener("change", ()=>{
  if(quizState.running) startTimer(true);
  else{
    quizState.timeTotalMs = Number(quizTime.value)*1000;
    quizState.timeLeftMs = quizState.timeTotalMs;
    updateTimerUI();
  }
});

/* =========================
   INIT
   ========================= */
renderResults("");
updateScoreUI();
updateBestUI();
updateWorstUI();
setQuizKanji("ä¸€", false);
</script>
</body>
</html>
